# ------------------------------------------------------------
# 컴파일러 및 기본 플래그
# ------------------------------------------------------------
CXX       := g++
CXXFLAGS  := -std=c++17 -O2
SANFLAGS  := -fsanitize=address -g

# ------------------------------------------------------------
# 프로젝트 디렉토리
# ------------------------------------------------------------
UTIL_DIR    := utils
ALGO_DIR    := algorithms

# ------------------------------------------------------------
# 소스 파일 목록
# ------------------------------------------------------------
# 알고리즘 모듈(소스)
ALGO_SRCS   := $(wildcard $(ALGO_DIR)/*.cpp)

# 평가용 실행 파일 소스
EVAL_SRC    := eval.cpp

# ------------------------------------------------------------
# 오브젝트 파일 목록 (알고리즘 모듈만)
# ------------------------------------------------------------
ALGO_OBJS   := $(ALGO_SRCS:.cpp=.o)

# ------------------------------------------------------------
# 최종 타깃
# ------------------------------------------------------------
TARGETS     := eval

# ------------------------------------------------------------
# 인클루드 디렉토리 (헤더 파일 경로)
# ------------------------------------------------------------
INCLUDES    := -I$(UTIL_DIR)

# ------------------------------------------------------------
# 디폴트 타깃: all
# ------------------------------------------------------------
.PHONY: all
all: $(TARGETS)

# ------------------------------------------------------------
# eval 실행 파일 생성
# ------------------------------------------------------------
eval: $(EVAL_SRC) $(ALGO_OBJS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $@ $^

# ------------------------------------------------------------
# 알고리즘 모듈(.cpp → .o) 컴파일 규칙
# ------------------------------------------------------------
$(ALGO_DIR)/%.o: $(ALGO_DIR)/%.cpp $(ALGO_DIR)/%.h
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# ------------------------------------------------------------
# AddressSanitizer를 포함한 디버그 빌드
# ------------------------------------------------------------
.PHONY: debug
debug: CXXFLAGS += $(SANFLAGS)
debug: clean all

# ------------------------------------------------------------
# 임시 파일 및 실행 파일 정리
# ------------------------------------------------------------
.PHONY: clean
clean:
	$(RM) $(ALGO_OBJS) $(TARGETS)